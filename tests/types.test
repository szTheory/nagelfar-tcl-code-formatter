#------------------------------------------------------------*- tcl -*-
# Tests for types
#----------------------------------------------------------------------
# $Revision$
#----------------------------------------------------------------------

test types-1.1 {
    Types checking
} -body {
    createTestFile {
        set apa [list x y z]
        llength $apa
    }
    execTestFile
} -result {%%}

test types-2.1 {
    Types in overwritten vars.
} -body {
    createTestFile {
        set apa [frame .f -padx 3 -pady 3]
        $apa configure -gurkmeja 2
        # A non-type does not overwrite
        set apa "Hej"
        $apa gurkmeja
        # A type might overwrite
        set apa [button .b]
        $apa configure -gurkmeja 2
    }
    execTestFile
} -result {%%Line   3: E Bad option -gurkmeja to "_obj,frame configure"
Line   6: E Unknown subcommand "gurkmeja" to "_obj,frame"
Line   9: E Bad option -gurkmeja to "_obj,button configure"}

test types-3.1 {
    Types in arrays
} -body {
    createTestFile {
        set w .t
        set data(sbar)   [scrollbar $w.sbar]
        set data(canvas) [canvas $w.canvas]
        $data(sbar) configure -command [list $data(canvas) xview]
        $data(canvas) configure -xscrollcommand [list $data(sbar) set]
    }
    execTestFile
} -result {%%}

test types-4.1 {
    Types in inline comments
} -body {
    createTestFile {
        set apa [frame .f -padx 3 -pady 3]
        $apa configure -gurkmeja 2
        ##nagelfar variable apa varName
        set $apa
    }
    execTestFile
} -result {%%Line   3: E Bad option -gurkmeja to "_obj,frame configure"}

test types-4.2 {
    Types in inline comments
} -body {
    createTestFile {
        set apa [frame .f -padx 3 -pady 3]
        $apa configure -gurkmeja 2
        ##nagelfar vartype apa varName
        set $apa
    }
    execTestFile
} -result {%%Line   3: E Bad option -gurkmeja to "_obj,frame configure"}

test types-4.3 {
    Types in inline comments
} -body {
    createTestFile {
        # vartype cannot create the varaible
        ##nagelfar vartype apa varName
        list $apa
    }
    execTestFile
} -result {%%Line   3: E Unknown variable "apa"
Line   4: E Unknown variable "apa"}

test types-5.1 {
    Types, option
} -body {
    createTestFile {
        set lst "hej hopp"
        set apa -decreasing
        ##nagelfar vartype apa option
        lsort -real $apa $lst
        lsort $apa       $lst
        lsort $apa -real $lst
        lsort -real $apa $lst $lst
        lsort $apa       $lst $lst
        lsort $apa -real $lst $lst
    }
    execTestFile
} -result {%%Line   8: E Wrong number of arguments (4) to "lsort"
Line   9: E Wrong number of arguments (3) to "lsort"
Line  10: E Wrong number of arguments (4) to "lsort"}

test types-5.2 {
    Types, option
} -body {
    createTestFile {
        set lst "hej hopp"
        set apa -decreasing
        ##nagelfar vartype apa option
        lsort -real {*}$apa $lst
        lsort {*}$apa       $lst
        lsort {*}$apa -real $lst
        # These should be detected
        lsort -real {*}$apa $lst $lst
        lsort {*}$apa       $lst $lst
        lsort {*}$apa -real $lst $lst
    }
    execTestFile
} -result {%%Line   9: E Wrong number of arguments (4) to "lsort"
Line  10: E Wrong number of arguments (3) to "lsort"
Line  11: E Wrong number of arguments (4) to "lsort"}
